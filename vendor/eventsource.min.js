/*
 * EventSource polyfill version 0.9.7
 * Supported by sc AmvTek srl
 * :email: devel@amvtek.com
 * :source: https://github.com/amvtek/EventSource
 */
 (function(g){function k(a,c,b){var d=window.location.origin;this.cancelable=this.cancelBubble=this.bubbles=!1;this.data=c||null;this.origin=d||"";this.lastEventId=b||"";this.type=a||"message"}if(!g.EventSource||g.K){var l=(g.K||"")+"EventSource",e=function(a,c){if(!a||"string"!=typeof a)throw new SyntaxError("Not enough arguments");this.URL=a;this.R(c);var b=this;setTimeout(function(){b.G()},0)};e.prototype={CONNECTING:0,OPEN:1,CLOSED:2,w:{F:!1,N:"eventsource",interval:500,m:262144,o:3E5,f:{evs_buffer_size_limit:262144},
J:{Accept:"text/event-stream","Cache-Control":"no-cache","X-Requested-With":"XMLHttpRequest"}},R:function(a){var c=this.w,b;for(b in c)c.hasOwnProperty(b)&&(this[b]=c[b]);for(b in a)b in c&&a.hasOwnProperty(b)&&(this[b]=a[b]);this.f&&this.m&&(this.f.evs_buffer_size_limit=this.m);if("undefined"===typeof console||"undefined"===typeof console.log)this.F=!1},log:function(a){this.F&&console.log("["+this.N+"]:"+a)},G:function(){try{this.readyState!=this.CLOSED&&(this.v(),this.readyState=this.CONNECTING,
this.cursor=0,this.cache="",this.c=new this.h(this),this.H())}catch(a){this.log("There were errors inside the pool try-catch"),this.dispatchEvent("error",{type:"error",data:a.message})}},j:function(a){var c=this;c.readyState=c.CONNECTING;c.dispatchEvent("error",{type:"error",data:"Reconnecting "});this.i=setTimeout(function(){c.G()},a||0)},v:function(){this.log("evs cleaning up");this.i&&(clearInterval(this.i),this.i=null);this.g&&(clearInterval(this.g),this.g=null);this.c&&(this.c.abort(),this.c=
null)},H:function(){if(this.o){this.g&&clearInterval(this.g);var a=this;this.g=setTimeout(function(){a.log("Timeout! silentTImeout:"+a.o);a.j()},this.o)}},close:function(){this.readyState=this.CLOSED;this.log("Closing connection. readyState: "+this.readyState);this.v()},l:function(){var a=this.c;if(a.D()&&!a.B()){this.H();this.readyState==this.CONNECTING&&(this.readyState=this.OPEN,this.dispatchEvent("open",{type:"open"}));var c=a.A();c.length>this.m&&(this.log("buffer.length > this.bufferSizeLimit"),
this.j());0==this.cursor&&0<c.length&&"\ufeff"==c.substring(0,1)&&(this.cursor=1);var b=this.M(c);b[0]>=this.cursor&&(b=b[1],this.P(c.substring(this.cursor,b)),this.cursor=b);a.C()&&(this.log("request.isDone(). reopening the connection"),this.j(this.interval))}else this.readyState!==this.CLOSED&&(this.log("this.readyState !== this.CLOSED"),this.j(this.interval))},P:function(a){a=this.cache+this.O(a);a=a.split("\n\n");var c,b,d,e,f;for(c=0;c<a.length-1;c++){d="message";e=[];parts=a[c].split("\n");
for(b=0;b<parts.length;b++)f=this.S(parts[b]),0==f.indexOf("event")?d=f.replace(/event:?\s*/,""):0==f.indexOf("retry")?(f=parseInt(f.replace(/retry:?\s*/,"")),isNaN(f)||(this.interval=f)):0==f.indexOf("data")?e.push(f.replace(/data:?\s*/,"")):0==f.indexOf("id:")?this.lastEventId=f.replace(/id:?\s*/,""):0==f.indexOf("id")&&(this.lastEventId=null);e.length&&this.dispatchEvent(d,new k(d,e.join("\n"),this.lastEventId))}this.cache=a[a.length-1]},dispatchEvent:function(a,c){var b=this["_"+a+"Handlers"];
if(b)for(var d=0;d<b.length;d++)b[d].call(this,c);this["on"+a]&&this["on"+a].call(this,c)},addEventListener:function(a,c){this["_"+a+"Handlers"]||(this["_"+a+"Handlers"]=[]);this["_"+a+"Handlers"].push(c)},removeEventListener:function(a,c){var b=this["_"+a+"Handlers"];if(b)for(var d=b.length-1;0<=d;--d)if(b[d]===c){b.splice(d,1);break}},i:null,c:null,lastEventId:null,cache:"",cursor:0,onerror:null,onmessage:null,onopen:null,readyState:0,I:function(a,c){var b=[];if(c){var d,e,f=encodeURIComponent;
for(d in c)c.hasOwnProperty(d)&&(e=f(d)+"="+f(c[d]),b.push(e))}return 0<b.length?-1==a.indexOf("?")?a+"?"+b.join("&"):a+"&"+b.join("&"):a},M:function(a){var c=a.lastIndexOf("\n\n"),b=a.lastIndexOf("\r\r");a=a.lastIndexOf("\r\n\r\n");return a>Math.max(c,b)?[a,a+4]:[Math.max(c,b),Math.max(c,b)+2]},S:function(a){return a.replace(/^(\s|\u00A0)+|(\s|\u00A0)+$/g,"")},O:function(a){return a.replace(/\r\n|\r/g,"\n")}};if(window.XDomainRequest&&window.XMLHttpRequest&&void 0===(new XMLHttpRequest).responseType){e.L=
"IE_8-9";var h=e.prototype.w;h.J=null;h.f.evs_preamble=2056;e.prototype.h=function(a){this.a=request=new XDomainRequest;request.onprogress=function(){request.u=!0;a.l()};request.onload=function(){this.s=!0;a.l()};request.onerror=function(){this.b=!0;a.readyState=a.CLOSED;a.dispatchEvent("error",{type:"error",data:"XDomainRequest error"})};request.ontimeout=function(){this.b=!0;a.readyState=a.CLOSED;a.dispatchEvent("error",{type:"error",data:"XDomainRequest timed out"})};var c={};if(a.f){var b=a.f,
d;for(d in b)b.hasOwnProperty(d)&&(c[d]=b[d]);a.lastEventId&&(c.evs_last_event_id=a.lastEventId)}request.open("GET",a.I(a.URL,c));request.send()};e.prototype.h.prototype={a:null,u:!1,s:!1,b:!1,D:function(){return this.a.u},C:function(){return this.a.s},B:function(){return this.a.b},A:function(){var a="";try{a=this.a.responseText||""}catch(c){}return a},abort:function(){this.a&&this.a.abort()}}}else e.L="XHR",e.prototype.h=function(a){this.a=request=new XMLHttpRequest;a.c=this;request.onreadystatechange=
function(){1<request.readyState&&a.readyState!=a.CLOSED&&(200==request.status||300<=request.status&&400>request.status?a.l():(request.b=!0,a.readyState=a.CLOSED,a.dispatchEvent("error",{type:"error",data:"The server responded with "+request.status}),a.close()))};request.onprogress=function(){};request.open("GET",a.I(a.URL,a.f),!0);var c=a.J,b;for(b in c)c.hasOwnProperty(b)&&request.setRequestHeader(b,c[b]);a.lastEventId&&request.setRequestHeader("Last-Event-Id",a.lastEventId);request.send()},e.prototype.h.prototype=
{a:null,b:!1,D:function(){return 2<=this.a.readyState},C:function(){return 4==this.a.readyState},B:function(){return this.b||400<=this.a.status},A:function(){var a="";try{a=this.a.responseText||""}catch(c){}return a},abort:function(){this.a&&this.a.abort()}};g[l]=e}})(this);
